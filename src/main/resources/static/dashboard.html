<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shadow Ledger Command</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Matrix-style scrolling animation */
        @keyframes scan { from { background-position: 0 0; } to { background-position: 0 100%; } }
        .scanlines {
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2));
            background-size: 100% 4px;
            animation: scan 1s linear infinite;
        }
    </style>
</head>
<body class="bg-gray-900 text-white font-sans h-screen overflow-hidden">

    <div class="border-b border-gray-700 p-4 flex justify-between items-center bg-gray-900 z-10 relative">
        <h1 class="text-2xl font-bold tracking-widest text-blue-500">
            SHADOW LEDGER <span class="text-xs text-gray-500 ml-2">// PERMISSIONED AUDIT NODE</span>
        </h1>
        <div class="flex space-x-4 text-xs font-mono">
            <div class="flex items-center"><span class="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></span> AI SENTINEL ONLINE</div>
            <div class="flex items-center"><span class="w-2 h-2 bg-purple-500 rounded-full mr-2"></span> TSA AUTHORITY SYNCED</div>
        </div>
    </div>

    <div class="grid grid-cols-12 gap-0 h-full">

        <div class="col-span-8 border-r border-gray-700 bg-black relative p-6 overflow-y-auto" id="ledger-container">
            <div class="scanlines absolute inset-0 pointer-events-none opacity-10"></div>
            <h2 class="text-gray-500 font-mono text-xs mb-4 uppercase">Immutable Ledger Stream</h2>
            <div id="ledger-content" class="space-y-2">
                <p class="text-gray-600 font-mono text-sm animate-pulse">Waiting for blocks...</p>
            </div>
        </div>

        <div class="col-span-4 bg-gray-800 p-6 flex flex-col space-y-6">

            <div class="bg-gray-900 border border-gray-700 p-4 rounded-lg">
                <h3 class="text-gray-400 text-xs uppercase mb-2">Network Threat Level</h3>
                <div class="text-4xl font-black text-green-500" id="threat-level">LOW</div>
            </div>

            <div class="bg-gray-900 border border-gray-700 p-4 rounded-lg flex-1">
                <h3 class="text-gray-400 text-xs uppercase mb-4">Cryptographic Strategy Mix</h3>
                <div class="space-y-3 font-mono text-sm">
                    <div class="flex justify-between"><span>MERKLE (SHA256)</span><span class="text-blue-400">65%</span></div>
                    <div class="w-full bg-gray-700 h-1"><div class="bg-blue-500 h-1" style="width: 65%"></div></div>

                    <div class="flex justify-between"><span>TSA (RSA-2048)</span><span class="text-purple-400">25%</span></div>
                    <div class="w-full bg-gray-700 h-1"><div class="bg-purple-500 h-1" style="width: 25%"></div></div>

                    <div class="flex justify-between"><span>ZKP (COMMIT)</span><span class="text-gray-400">10%</span></div>
                    <div class="w-full bg-gray-700 h-1"><div class="bg-gray-500 h-1" style="width: 10%"></div></div>
                </div>
            </div>

        </div>
    </div>

    <script>
        async function fetchBlocks() {
            try {
                const res = await fetch('/api/v1/audit/blocks');
                const data = await res.json();
                const list = document.getElementById('ledger-content');

                if(data.length > 0) list.innerHTML = ''; // Clear loading text

                // Show newest first
                data.reverse().forEach(block => {
                    let badgeColor = "text-green-400 border-green-900";
                    let icon = "üå≥";

                    if (block.merkleRoot.includes("RSA")) { badgeColor = "text-purple-400 border-purple-900"; icon = "‚öñÔ∏è"; }
                    if (block.merkleRoot.includes("COMMIT")) { badgeColor = "text-gray-400 border-gray-700"; icon = "üëª"; }
                    if (block.merkleRoot.includes("PENDING")) { badgeColor = "text-yellow-400 border-yellow-900"; icon = "üîê"; }

                    const row = `
                        <div class="p-3 bg-gray-900 border border-gray-800 rounded font-mono text-sm hover:border-gray-600 transition-colors">
                            <div class="flex justify-between mb-1">
                                <span class="text-blue-500 font-bold">[BLOCK #${block.blockHeight}]</span>
                                <span class="text-xs text-gray-500">${new Date(block.timestamp).toLocaleTimeString()}</span>
                            </div>
                            <div class="flex items-start">
                                <span class="mr-2 text-lg">${icon}</span>
                                <div class="break-all text-xs opacity-80 ${badgeColor}">
                                    HASH: ${block.merkleRoot}
                                </div>
                            </div>
                        </div>`;
                    list.innerHTML += row;
                });
            } catch (e) { console.log("Connection to Node lost."); }
        }

        // Auto-Refresh every 2 seconds
        setInterval(fetchBlocks, 2000);
        fetchBlocks(); // Initial call
    </script>
</body>
</html>
